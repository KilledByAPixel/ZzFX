// ZzFX - Zuper Zmall Zound Zynth
// MIT License - Copyright 2019 Frank Force
// https://github.com/KilledByAPixel/ZzFX

"use strict";const ZZFX=new class{constructor(){this.x=this.CreateAudioContext(),this.volume=.3,this.sampleRate=44100,this.samples=0}Play(a){var t=a&&"object"==typeof a?this.SoundToArray(a):arguments;return t=this.BuildSamples(...t),this.PlaySamples(t)}PlaySamples(a){const t=this.x.createBuffer(1,a.length,this.sampleRate),n=this.x.createBufferSource();return t.getChannelData(0).set(a),n.buffer=t,n.connect(this.x.destination),n.start(),this.samples=a,n}BuildSamples(a=1,t=.05,n=220,e=0,r=0,o=.1,h=0,s=1,d=0,m=0,i=0,u=0,M=0,l=0,c=0,p=0,f=0,S=1,B=0){let x=2*Math.PI;var y=this.sampleRate;let C=d*=500*x/y**2,b=(0<c?1:-1)*x/4;t=n*=(1+2*t*Math.random()-t)*x/y,m*=500*x/y**3,c*=x/y,i*=x/y,u*=y,M*=y,y=(e=99+e*y)+(B*=y)+(r*=y)+(o*=y)+(f*=y);let v=[],A=0,P=0,R=0,T=1,w=0,g=0,k=0;for(;R<y;v[R++]=k)++g>100*p&&(g=0,k=A*n*Math.sin(P*c-b),k=h?1<h?2<h?3<h?Math.sin((k%x)**3):Math.max(Math.min(Math.tan(k),1),-1):1-(2*k/x%2+2)%2:1-4*Math.abs(Math.round(k/x)-k/x):Math.sin(k),k=(0<k?1:-1)*Math.abs(k)**s,k*=a*this.volume*(R<e?R/e:R<e+B?1-(R-e)/B*(1-S):R<e+B+r?S:R<y-f?(y-R-f)/o*S:0),k=f?k/2+(f>R?0:(R<y-f?1:(R-y)/f)*v[R-f|0]/2):k),A+=1-l+1e9*(Math.sin(R)+1)%2*l,P+=1-l+1e9*(Math.sin(R)**2+1)%2*l,n+=d+=m,T&&++T>u&&(n+=i,t+=i,T=0),M&&++w>M&&(n=t,d=C,w=1,T=T||1);return v}BuildRandomSound(a=1,t=1,n=.05){const e=Math.random()**3/4*a,r=Math.random()**3/4*a,o=Math.random()**3/4*a,h=e+r+o+(a*=Math.random()**3/4);return this.BuildSound(t,n,2e3*Math.random()**2,e,o,a,5*Math.random()|0,3*Math.random()**2,99*(.5>Math.random()?Math.random():0)**3*(.5>Math.random()&&Math.random()?1:-1),99*(.5>Math.random()?Math.random():0)**3*(.5>Math.random()&&Math.random()?1:-1),1e3*(.5>Math.random()?Math.random():0)**2*(.5>Math.random()&&Math.random()?1:-1),Math.random()**2*h,(.5>Math.random()?Math.random():0)*h,(.5>Math.random()?Math.random():0)**4,9*(.5>Math.random()?Math.random():0)**3*(.5>Math.random()&&Math.random()?1:-1),(.5>Math.random()?Math.random():0)**4,(.5>Math.random()?Math.random():0)**3/2,1-(.5>Math.random()?Math.random():0),r)}BuildSound(a=1,t=.05,n=220,e=0,r=0,o=.1,h=0,s=1,d=0,m=0,i=0,u=0,M=0,l=0,c=0,p=0,f=0,S=1,B=0){return{volume:a,randomness:t,frequency:n,attack:e,sustain:r,release:o,shape:h,shapeCurve:s,slide:d,deltaSlide:m,pitchJump:i,pitchJumpTime:u,repeatTime:M,noise:l,modulation:c,bitCrush:p,delay:f,sustainVolume:S,decay:B}}GetNote(a=0,t=440){return t*2**(a/12)}SoundToArray(a){const t=this.BuildSound(),n=[];for(const e in t)n.push(a[e]);return n}CreateAudioContext(){const a=new(AudioContext||webkitAudioContext);return a.a=a.createBufferSource,a.createBufferSource=(t=a.a())=>(t.start=t.start||(t=>a.noteOn(t)),t.stop=t.stop||(t=>a.noteOff(t)),t),a}};function zzfx(){return ZZFX.Play(...arguments)};